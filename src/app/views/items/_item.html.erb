<% if defined? show_replying %>
  <div class="item-reply">
    <% if !item.replying.empty? %>
      <div class="item-reply-from">
        📩返信先
      </div>
      <% item.replying.each do |reply| %>
        <%= render 'items/item', item: reply %>
      <% end %>
    <% end %>
  </div>
<% end %>

<div class="item">
  <div class="item-owners">
    <div class="item-owners-account">
      <%= link_to account_path(item.account.name_id) do %>
        <div class="ioa-link">
          <% if false %>
            <%= image_tag image_url(aid: item.account.icon_key, type: 'icons'), class: 'ioa-icon' %>
          <% else %>
            <%= image_tag 'icon.webp', class: 'ioa-icon' %>
          <% end %>
          <div class="ioa-profile">
            <div class="ioa-name">
              <%= item.account.name %>
            </div>
            <div class="ioa-nameid">
              @<%= item.account.name_id %>
            </div>
          </div>
        </div>
      <% end %>
      <div class="ioa-badges">
        <div>🍭</div>
        <div>💕</div>
        <div>🫧</div>
        <div>🌈</div>
        <div>💮</div>
        <div>🔰</div>
      </div>
      <div class="ioa-others">
        <div class="ioa-button-wrap">
          <div class="ioa-button">
            <% if @current_account && @current_account.following.exists?(item.account.id) %>
              <%= button_to("フォロー解除", follow_path(item.account.name_id), method: :post) %>
            <% elsif @current_account %>
              <%= button_to("フォローする", follow_path(item.account.name_id), method: :post) %>
            <% else %>
              <%= button_to('ログインしてフォロー', login_path, method: :get) %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="item-details">
    <div class="item-details-kind">
      <%# item.kind %>
    </div>
    <div class="item-details-kind">
      <%# item.kind %>
    </div>
    <div class="item-details-id">
    </div>
    <div class="item-details-date">
      <%= link_to item.created_at.strftime("%Y年 %m月 %d日 %k時 %M分 %S秒"), item_path(item.aid) %>
    </div>
  </div>
  <div class="item-content">
    <%= item.content %>
  </div>
  <div class="item-media">
    <% item.images.each do |image| %>
      <%= image_tag image.image_url, class: 'item-image' %>
    <% end %>
    <% if false %>
      <video controls class='video-view' id='video-<%= video.video_id %>'></video>
      <script src="https://cdn.jsdelivr.net/npm/hls.js@1"></script>
      <script>
        var video = document.getElementById('video-<%= video.video_id %>');
        var videoSrc = 'http://localhost:9000/development/variants/accounts/00000000000000/videos/<%= video.video_id %>/output.m3u8';
        if (Hls.isSupported()) {
          var hls = new Hls();
          hls.loadSource(videoSrc);
          hls.attachMedia(video);
        }
      </script>
    <% end %>
  </div>
  <div style="text-align:right; font-size:11px;">
    <%= link_to item.aid, item_path(item.aid) %>
  </div>
  <div class="item-reactions">
    <% item.emojis.each do |emoji| %>
      <div class="item-reaction">
        <%= button_to react_path(item.aid, emoji.aid), method: :post do %>
          <% if false %>
            <%= image_tag image_url(model: 'emojis', type: 'tb-emojis', aid: emoji.aid), class: '' %>
          <% else %>
            <%= emoji.name %>
          <% end %>
          <span><%= item.reactions.where(emoji_id: emoji.id).size %></span>
        <% end%>
      </div>
    <% end %>
  </div>
  <div class="item-panel">
    <div class="item-tab">
      <input id="aid_<%= item.aid %>_tab_replying" type="radio" name="tab_menu">
      <label class="tab_menu" for="aid_<%= item.aid %>_tab_replying">返信先<%= item.replying.size %></label>
      <input id="aid_<%= item.aid %>_tab_replies" type="radio" name="tab_menu">
      <label class="tab_menu" for="aid_<%= item.aid %>_tab_replies">返信<%= item.repliers.size %></label>
      <input id="aid_<%= item.aid %>_tab_diffusions" type="radio" name="tab_menu">
      <label class="tab_menu" for="aid_<%= item.aid %>_tab_diffusions">拡散<%= 0 %></label>
      <input id="aid_<%= item.aid %>_tab_quoting" type="radio" name="tab_menu">
      <label class="tab_menu" for="aid_<%= item.aid %>_tab_quoting">引用元<%= item.quoting.size %></label>
      <input id="aid_<%= item.aid %>_tab_quoters" type="radio" name="tab_menu">
      <label class="tab_menu" for="aid_<%= item.aid %>_tab_quoters">引用<%= item.quoters.size %></label>
      <input id="aid_<%= item.aid %>_tab_reactions" type="radio" name="tab_menu">
      <label class="tab_menu" for="aid_<%= item.aid %>_tab_reactions">リアクション<%= item.reactions.size %></label>
      <input id="aid_<%= item.aid %>_tab_share" type="radio" name="tab_menu">
      <label class="tab_menu" for="aid_<%= item.aid %>_tab_share">共有</label>
      <input id="aid_<%= item.aid %>_tab_save" type="radio" name="tab_menu">
      <label class="tab_menu" for="aid_<%= item.aid %>_tab_save">保存</label>
      <input id="aid_<%= item.aid %>_tab_others" type="radio" name="tab_menu">
      <label class="tab_menu" for="aid_<%= item.aid %>_tab_others">その他</label>
      <details>
        <summary>詳しく</summary>
        <div id="aid_<%= item.aid %>_tab_replying_content" class="tab_content">
          返信先の表示
          <% if !item.replying.empty? %>
            <div class="item-reply-from">
              📩返信先
            </div>
            <% item.replying.each do |reply| %>
              <%= link_to reply.aid, item_path(reply.aid) %>
            <% end %>
          <% else %>
            返信先はありません
          <% end %>
        </div>
        <div id="aid_<%= item.aid %>_tab_replies_content" class="tab_content">
          <%= link_to '返信する', item_reply_path(item.aid) %>
          <%# render 'items/form', initial_replied: item.aid %>
        </div>
        <div id="aid_<%= item.aid %>_tab_diffusions_content" class="tab_content">
          拡散する
          <%= button_to '拡散する' %>
        </div>
        <div id="aid_<%= item.aid %>_tab_quoting_content" class="tab_content">
          引用元の表示
          <% if !item.quoting.empty? %>
            <div class="item-quote-from">
              📩引用元
            </div>
            <% item.quoting.each do |quote| %>
              <%= link_to quote.aid, item_path(quote.aid) %>
            <% end %>
          <% else %>
            引用元はありません
          <% end %>
        </div>
        <div id="aid_<%= item.aid %>_tab_quoters_content" class="tab_content">
          <%= link_to '引用する', item_quote_path(item.aid) %>
          <%# render 'items/form', initial_quoted: item.aid %>
        </div>
        <div id="aid_<%= item.aid %>_tab_reactions_content" class="tab_content">
          <%= link_to 'リアクションする', item_quote_path(item.aid) %>
          <%# Emoji.all.each do |emoji| %>
            <%# button_to react_path(item.aid, emoji.aid), method: :post do %>
              <%# if false %>
                <%# image_tag image_url(model: 'emojis', type: 'tb-emojis', aid: emoji.aid), class: '' %>
              <%# else %>
                <%# emoji.name %>
              <%# end %>
            <%# end%>
          <%# end %>
        </div>
        <div id="aid_<%= item.aid %>_tab_share_content" class="tab_content">
          共有する
          https://amiverse.net/items/<%= item.aid %>
        </div>
        <div id="aid_<%= item.aid %>_tab_save_content" class="tab_content">
          保存する
          ダウンロード・ブックマーク
        </div>
        <div id="aid_<%= item.aid %>_tab_others_content" class="tab_content">
          その他
          アナリティクス
          埋め込む
          報告
        </div>
      </details>
      <style>
        #aid_<%= item.aid %>_tab_replying:checked ~ details #aid_<%= item.aid %>_tab_replying_content,
        #aid_<%= item.aid %>_tab_replies:checked ~ details #aid_<%= item.aid %>_tab_replies_content,
        #aid_<%= item.aid %>_tab_diffusions:checked ~ details #aid_<%= item.aid %>_tab_diffusions_content,
        #aid_<%= item.aid %>_tab_quoting:checked ~ details #aid_<%= item.aid %>_tab_quoting_content,
        #aid_<%= item.aid %>_tab_quoters:checked ~ details #aid_<%= item.aid %>_tab_quoters_content,
        #aid_<%= item.aid %>_tab_reactions:checked ~ details #aid_<%= item.aid %>_tab_reactions_content,
        #aid_<%= item.aid %>_tab_share:checked ~ details #aid_<%= item.aid %>_tab_share_content,
        #aid_<%= item.aid %>_tab_save:checked ~ details #aid_<%= item.aid %>_tab_save_content,
        #aid_<%= item.aid %>_tab_others:checked ~ details #aid_<%= item.aid %>_tab_others_content {
            display: block;
        }
      </style>
    </div>
  </div>
</div>

<% if defined? show_repliers %>
  <div class="item-reply">
    <% if !item.repliers.empty? %>
      <div class="item-reply-from">
        📩返信
      </div>
      <% item.repliers.each do |reply| %>
        <%= render 'items/item', item: reply %>
      <% end %>
    <% end %>
  </div>
<% end %>