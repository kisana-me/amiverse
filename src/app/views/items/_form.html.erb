<% if @current_account.present? %>
  <% item = Item.new %>
  <%= form_with model: item, url: create_item_path do |f| %>
    <%= render "shared/error_messages", instead: item %>
    <% if (defined? initial_replied) %>
      <%= f.hidden_field :replied, value: initial_replied %>
      投稿:<%= initial_replied %>への返信
    <% end %>
    <% if (defined? initial_quoted) %>
      <%= f.hidden_field :quoted, value: initial_quoted %>
      投稿:<%= initial_quoted %>への引用
    <% end %>

    <div>
      <%= f.label :visibility %>
      <%= f.select :visibility, Item.visibilities.keys.map { |i| [i.humanize, i] } %>
      <%= f.label :silent %>
      <%= f.check_box :silent %>
      <%= f.label :draft %>
      <%= f.check_box :draft %>
    </div>

    <div>
      <%= f.label :content, style: "display: block" %>
      <%= f.text_area :content %>
    </div>

    <div>
      <details>
        <summary>メディア</summary>
        <%= f.label :media %>
        <%= f.file_field :media, multiple: true, accept: 'image/*,audio/*,video/*' %>
        <details>
          <summary>画像を添付</summary>
          <%= render 'images/images_selector', f: f, images: @current_account.images.where(deleted: false) %>
        </details>
        <details>
          <summary>動画を添付</summary>
          <% @current_account.videos.each do |video| %>
            <%= f.check_box :selected_videos, { multiple: true }, video.video_id, nil %>
            <%= f.label video.video_id %>
          <% end %>
        </details>
      </details>
      <details>
        <summary>センシティブ</summary>
        <%= f.label :sensitive %>
        <%= f.check_box :sensitive %>
        <%= f.label :caution_message %>
        <%= f.text_field :caution_message %>
      </details>
      <details>
        <summary>投票</summary>
        <%= f.label :poll %>
        <%= f.check_box :poll %>
      </details>
      <details>
        <summary>予約</summary>
        <%= f.label :yoyaku %>
        <%= f.check_box :yoyaku %>
      </details>
      <details>
        <summary>場所</summary>
        <%= f.label :location %>
        <%= f.check_box :location %>
      </details>
    </div>

    
    <details>
      <summary>設定</summary>
      <div>
        <%= f.label :render_type %>
        <%= f.select :render_type, Item.render_types.keys.map { |i| [i.humanize, i] } %>
        <br />
        <%= f.label :layout_type %>
        <%= f.select :layout_type, Item.layout_types.keys.map { |i| [i.humanize, i] } %>
        <br />
        <%= f.label :usage_type %>
        <%= f.select :usage_type, Item.usage_types.keys.map { |i| [i.humanize, i] } %>
        <br />
        <%= f.label :activitypub %>
        <%= f.check_box :activitypub %>
        <br />
        <%= f.label :language %>
        <%= f.select :language, Item.languages.keys.map { |i| [i.humanize, i] } %>
      </div>
    </details>

    <div>
      <%= f.submit %>
    </div>
  <% end %>
<% else %>
  <%= button_to('ログインして会話に参加', login_path, method: :get) %>
<% end %>